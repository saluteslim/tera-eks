apiVersion: batch/v1
kind: CronJob
metadata:
  name: terminate-ec2-cronjob
  namespace: argocd
spec:
  schedule: "*/2 * * * *"  # Cron expression (every 2 minutes in this case)
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: terminate-ec2-container
            image: amazon/aws-cli:latest  # Use the AWS CLI image directly
            command: ["/bin/bash", "-c"]
            args:
            - |
              apt update && apt install -y awscli
              aws configure set aws_access_key_id "AKIAUBD4DVMLBIKEQIGL" && \
              aws configure set aws_secret_access_key "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" && \
              ./terminate_ec2.sh
          restartPolicy: OnFailure
